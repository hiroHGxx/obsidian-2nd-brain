# 🛡️ OpenClaw 行動制限・安全運用ルール

> **このファイルの目的**
> Discord経由でアクセスするOpenClawエージェントが、2nd-Brain Vaultを安全・効率的に扱うための運用ルールを定義します。Google Drive同期環境であるため、**最小限のファイルアクセス**で作業を完結させることが重要です。

---

## 🚨 絶対ルール（MUST）

### 1. ディレクトリの再帰スキャンを行わない
- `~/2nd-Brain` 配下で `ls -R`、`find` の無制限実行、`tree` コマンドなどは**禁止**
- フォルダ構造の把握は `~/2nd-Brain/_INDEX.md` を参照すること
- どうしても必要な場合は、深さ制限（maxdepth=1〜2相当）を設け、事前にユーザーに確認を取る

### 2. 曖昧な指示では探索せず、確認質問を返す
ユーザーから以下のような曖昧な指示を受けた場合、**ファイル探索を開始せず**、必ず確認質問を返してください。

#### ❌ 曖昧な指示の例
- 「日誌フォルダを見て最新のファイルを教えて」
- 「アウトプットに何があるか一覧を出して」
- 「プロジェクト関連のファイルを全部チェックして」
- 「○○について書かれたファイルを探して」

#### ✅ 正しい対応（確認質問）
```
申し訳ございませんが、効率的かつ安全に作業を進めるため、具体的なファイルパスを教えていただけますか？

例:
- 今日の日誌: ~/2nd-Brain/05_日誌/2026-02-01.md
- 執筆スタイル: ~/2nd-Brain/00_システム/00_UserProfile/03_執筆スタイル.md

どのファイルを確認すればよろしいでしょうか？
```

### 3. 読み取りは「具体的なファイルパス指定」があった場合のみ
- ユーザーが明示的に `~/2nd-Brain/[フォルダ名]/[ファイル名].md` の形式でパスを指定した場合のみファイルを読む
- パスが不明確な場合は、`_INDEX.md` の「よくあるタスク」セクションを参照し、適切なパスを提案する

### 4. 書き込みは「追記・コメント」を中心に
- **推奨**: 既存ファイルの末尾への追記、特定セクションへのコメント挿入
- **慎重対応が必要**: 既存内容の大規模改変、セクションの削除、ファイルの移動・リネーム
- **事前確認必須**: 複数ファイルにまたがる変更、システムファイル（`00_システム/` 配下）の編集

#### ✅ 安全な書き込み例
```
~/2nd-Brain/05_日誌/2026-02-01.md の末尾に以下を追記します:

---
## 追記 (OpenClaw)
- [追加内容]
```

#### ⚠️ 慎重対応が必要な例
```
~/2nd-Brain/00_システム/00_UserProfile/03_執筆スタイル.md の「NGワード」セクションを以下のように変更してもよろしいですか？

[変更前]
...
[変更後]
...

承認いただければ実行します。
```

### 5. Google Drive同期を考慮した最小アクセス
- `~/2nd-Brain` は Google Drive (CloudStorage) 経由で同期されており、I/Oが遅い前提で動作する
- **1回の作業で読むファイルは最大3〜5個**に抑える
- 大量のファイルを順次処理する必要がある場合は、バッチ処理の計画をユーザーに提示し、承認を得る

---

## ✅ OK例・❌ NG例

### ✅ OK: 具体的なパス指定での読み取り
```
ユーザー: 「~/2nd-Brain/05_日誌/2026-02-01.md を読んで要約して」
OpenClaw: [ファイルを読み、要約を返す]
```

### ✅ OK: 追記作業
```
ユーザー: 「今日の日誌に『夕食: カレー』を追記して」
OpenClaw: 「~/2nd-Brain/05_日誌/2026-02-01.md の末尾に追記します」
```

### ✅ OK: 確認質問による安全確保
```
ユーザー: 「日誌を見て最近の傾向を教えて」
OpenClaw: 「どの日付の日誌を確認すればよろしいでしょうか？例: ~/2nd-Brain/05_日誌/2026-01-25.md 〜 2026-02-01.md」
```

### ❌ NG: ディレクトリ全探索
```
ユーザー: 「日誌フォルダの中身を教えて」
OpenClaw: [ls ~/2nd-Brain/05_日誌/ を実行] ← これはNG
```

### ❌ NG: 曖昧な指示での自動処理
```
ユーザー: 「アウトプットフォルダにあるNote記事を全部チェックして」
OpenClaw: [find ~/2nd-Brain/04_アウトプット/ -name "*.md" を実行] ← これはNG
```

### ❌ NG: 無確認での大規模変更
```
ユーザー: 「執筆スタイルを最適化して」
OpenClaw: [~/2nd-Brain/00_システム/00_UserProfile/03_執筆スタイル.md を大幅に書き換え] ← これはNG
```

---

## 📋 確認質問テンプレート

OpenClawが曖昧な指示を受けた際に使用するテンプレートです。

### テンプレート1: ファイルパスが不明な場合
```
申し訳ございませんが、安全かつ効率的に作業を進めるため、具体的なファイルパスを教えていただけますか？

参考: ~/2nd-Brain/_INDEX.md の「よくあるタスク」セクションに例があります。

例:
- 今日の日誌: ~/2nd-Brain/05_日誌/[YYYY-MM-DD].md
- 執筆スタイル: ~/2nd-Brain/00_システム/00_UserProfile/03_執筆スタイル.md
- プロジェクト: ~/2nd-Brain/01_プロジェクト/[プロジェクト名]/[ファイル名].md
```

### テンプレート2: 大規模変更が必要そうな場合
```
ご指示の内容を実行するには、以下のファイルの変更が必要になります:
- [ファイル1のパス]
- [ファイル2のパス]

変更内容:
[具体的な変更内容]

この変更を実行してもよろしいでしょうか？
```

### テンプレート3: 探索が必要そうだが避けたい場合
```
ご指示の内容を実行するには、フォルダ内の複数ファイルを探索する必要があります。
Google Drive同期環境のため、探索には時間がかかる可能性があります。

代替案:
1. 具体的なファイルパスを指定していただく
2. ~/2nd-Brain/_INDEX.md を参照して、該当するファイルを特定する

どちらがよろしいでしょうか？
```

---

## 🔧 安全な作業手順（推奨フロー）

OpenClawは、以下の手順で作業を進めることを推奨します。

### 基本フロー: 読む → 要約 → 提案 → 承認 → 実行

1. **読む**: ユーザーから具体的なファイルパスを受け取り、内容を読み取る
2. **要約**: 読み取った内容を要約し、ユーザーに提示する
3. **提案**: 何をどう変更・追加するかを明示的に提案する
4. **承認**: ユーザーの承認を待つ（「OK」「実行して」などの明示的な許可）
5. **実行**: 承認後、変更を実行し、結果を報告する

### 例: 日誌への追記

```
[1. 読む]
ユーザー: 「~/2nd-Brain/05_日誌/2026-02-01.md に追記して」
OpenClaw: [ファイルを読む]

[2. 要約]
OpenClaw: 「現在の日誌には以下の内容が記録されています: [要約]」

[3. 提案]
OpenClaw: 「以下の内容を末尾に追記します:
---
## 追記 (OpenClaw)
- [ユーザーが指定した内容]
」

[4. 承認]
ユーザー: 「OK」

[5. 実行]
OpenClaw: [追記を実行]
OpenClaw: 「追記が完了しました」
```

---

## 🐛 困ったときのデバッグ手順

OpenClawがトラブルシューティングを行う際の**最小限・安全な**コマンド例です。

### 1. Vaultのルートディレクトリ確認
```bash
ls ~/2nd-Brain/
```
- **目的**: ルート直下のフォルダ・ファイル名を確認（深さ0）
- **注意**: `-R` オプションは使用しない

### 2. 特定フォルダの直下のみ確認（深さ1）
```bash
ls ~/2nd-Brain/05_日誌/
```
- **目的**: 日誌ファイルの一覧を確認
- **注意**: サブフォルダがある場合でも再帰しない

### 3. ファイルの存在確認
```bash
test -f ~/2nd-Brain/05_日誌/2026-02-01.md && echo "EXISTS" || echo "NOT_FOUND"
```
- **目的**: 特定のファイルが存在するか確認
- **利点**: ファイルを開かずに存在を確認できる

### 4. ファイルの最終更新日時確認
```bash
ls -l ~/2nd-Brain/05_日誌/2026-02-01.md
```
- **目的**: ファイルの更新日時を確認
- **用途**: 最新版かどうかの判断材料

### 5. フォルダ構造の浅い確認（緊急時のみ・深さ制限付き）
```bash
find ~/2nd-Brain/ -maxdepth 2 -type d
```
- **目的**: フォルダ構造の概要把握（深さ2まで）
- **注意**: ユーザーに事前確認を取ること
- **代替推奨**: `~/2nd-Brain/_INDEX.md` を読む方が安全

---

## 📖 参考ドキュメント

OpenClawは以下のファイルを適宜参照してください:

- **`~/2nd-Brain/_INDEX.md`**: Vault全体の案内図・ファイルパス例
- **`~/2nd-Brain/説明書_Second_Brain.md`**: システム全体の使い方・ワークフロー一覧
- **`~/2nd-Brain/00_はじめに実行する.md`**: 初期セットアップ手順（既存環境では不要）

---

## ⚙️ システム情報

- **Vault場所**: `~/2nd-Brain`
- **実体パス**: `~/Library/CloudStorage/GoogleDrive-hiro@monolb.com/マイドライブ/Obsidian/2nd-Brain`
- **同期方法**: Google Drive (CloudStorage)
- **同期デバイス**: メインPC・サブPC間
- **I/O特性**: 同期ストレージのため、ローカルディスクより遅い

---

## 🎯 まとめ: OpenClawの行動原則

1. **探索しない**: ディレクトリスキャンは最小限に
2. **確認する**: 曖昧な指示には質問で応える
3. **明示する**: 変更内容を事前に提示して承認を得る
4. **最小化する**: 1回の作業で触るファイルは3〜5個まで
5. **参照する**: `_INDEX.md` を積極的に活用

**これらを守ることで、OpenClawは安全・効率的にVaultを扱うことができます。**

---

**最終更新**: 2026-02-01
**対象エージェント**: OpenClaw (Discord経由)
**管理者**: gotohiro
